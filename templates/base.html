<!DOCTYPE html>
<html lang="{{ lang }}">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"
		/>
		<meta
			name="description"
			content="sTask Manager - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á"
		/>
		<meta name="theme-color" content="#0a0e27" />
		<title>{{ t('title') }}</title>

		<!-- Favicon -->
		<link
			rel="icon"
			type="image/png"
			href="{{ url_for('static', filename='images/iconDark.png') }}"
		/>
		<link
			rel="shortcut icon"
			type="image/png"
			href="{{ url_for('static', filename='images/iconDark.png') }}"
		/>

		<link
			rel="stylesheet"
			href="{{ url_for('static', filename='css/style.css') }}"
		/>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
	</head>
	<body data-theme="{{ theme }}">
		<div class="container">
			<nav>
				<a
					href="{{ url_for('index') if current_user.is_authenticated else url_for('login') }}"
					class="nav-brand"
				>
					<img
						src="{{ url_for('static', filename='images/iconDark.png' if theme == 'dark' else 'images/iconLight.png') }}"
						alt="Task Manager Logo"
						class="nav-icon"
						id="navIcon"
					/>
					Task Manager
				</a>
				<div class="nav-links">
					<!-- Language Dropdown -->
					<div class="lang-dropdown">
						<button class="lang-btn" id="langBtn">
							{% if lang == 'ru' %}RU {% elif lang == 'en' %}EN {% else %}UZ{%
							endif %}
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="16"
								height="16"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								style="margin-left: 4px"
							>
								<polyline points="6 9 12 15 18 9"></polyline>
							</svg>
						</button>
						<div class="lang-dropdown-menu" id="langMenu">
							<a
								href="{{ url_for('set_lang', language='ru') }}"
								class="lang-dropdown-item"
							>
								<span>–†—É—Å—Å–∫–∏–π</span>
								{% if lang == 'ru' %}
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="18"
									height="18"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
								>
									<polyline points="20 6 9 17 4 12"></polyline>
								</svg>
								{% endif %}
							</a>
							<a
								href="{{ url_for('set_lang', language='en') }}"
								class="lang-dropdown-item"
							>
								<span>English</span>
								{% if lang == 'en' %}
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="18"
									height="18"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
								>
									<polyline points="20 6 9 17 4 12"></polyline>
								</svg>
								{% endif %}
							</a>
							<a
								href="{{ url_for('set_lang', language='uz') }}"
								class="lang-dropdown-item"
							>
								<span>O'zbek</span>
								{% if lang == 'uz' %}
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="18"
									height="18"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
								>
									<polyline points="20 6 9 17 4 12"></polyline>
								</svg>
								{% endif %}
							</a>
						</div>
					</div>

					{% if current_user.is_authenticated %}
					<span
						style="
							color: var(--text-secondary);
							margin-left: 10px;
							font-weight: 500;
						"
						>üë§ {{ current_user.username }}</span
					>
					<a href="{{ url_for('logout') }}">{{ t('logout') }}</a>
					{% endif %}

					<a
						href="{{ url_for('toggle_theme') }}"
						class="theme-toggle"
						title="{{ t('theme_toggle') }}"
						id="themeToggle"
					>
						{{ 'üåô' if theme == 'dark' else '‚òÄÔ∏è' }}
					</a>
				</div>
			</nav>

			{% with messages = get_flashed_messages() %} {% if messages %} {% for
			message in messages %}
			<div style="padding: 1rem 2rem">
				<div
					style="
						background: rgba(248, 113, 113, 0.2);
						border: 1px solid rgba(248, 113, 113, 0.3);
						padding: 1rem;
						border-radius: 12px;
						color: var(--accent-red);
						font-weight: 500;
					"
				>
					{{ t(message) }}
				</div>
			</div>
			{% endfor %} {% endif %} {% endwith %} {% block content %}{% endblock %}
		</div>

		<script>
			// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã
			document
				.getElementById("themeToggle")
				?.addEventListener("click", function (e) {
					e.preventDefault();

					// –¢–µ–∫—É—â–∞—è —Ç–µ–º–∞
					const currentTheme = document.body.getAttribute("data-theme");
					const newTheme = currentTheme === "dark" ? "light" : "dark";

					// –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
					const navIcon = document.getElementById("navIcon");
					if (navIcon) {
						const newIconPath =
							newTheme === "dark"
								? "{{ url_for('static', filename='images/iconDark.png') }}"
								: "{{ url_for('static', filename='images/iconLight.png') }}";
						navIcon.src = newIconPath;
					}

					// –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
					window.location.href = this.href;
				});

			// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏–∫–æ–Ω–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
			document.addEventListener("DOMContentLoaded", function () {
				const currentTheme = document.body.getAttribute("data-theme");
				const navIcon = document.getElementById("navIcon");

				if (navIcon && currentTheme) {
					const iconPath =
						currentTheme === "dark"
							? "{{ url_for('static', filename='images/iconDark.png') }}"
							: "{{ url_for('static', filename='images/iconLight.png') }}";
					navIcon.src = iconPath;
				}
			});

			// Language dropdown
			const langBtn = document.getElementById("langBtn");
			const langMenu = document.getElementById("langMenu");

			if (langBtn && langMenu) {
				langBtn.addEventListener("click", function (e) {
					e.stopPropagation();
					langMenu.classList.toggle("show");
				});

				// Close dropdown when clicking outside
				document.addEventListener("click", function (e) {
					if (!langBtn.contains(e.target) && !langMenu.contains(e.target)) {
						langMenu.classList.remove("show");
					}
				});
			}
		</script>
	</body>
</html>
